

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>coapy.option &mdash; CoAPy 0.0.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="CoAPy 0.0.0 documentation" href="../../index.html" />
    <link rel="up" title="coapy" href="../coapy.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">CoAPy 0.0.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li>
          <li><a href="../coapy.html" accesskey="U">coapy</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for coapy.option</h1><div class="highlight"><pre>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="c"># Copyright 2013, Peter A. Bigot</span>
<span class="c">#</span>
<span class="c"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may</span>
<span class="c"># not use this file except in compliance with the License. You may obtain a</span>
<span class="c"># copy of the License at:</span>
<span class="c">#</span>
<span class="c">#            http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c">#</span>
<span class="c"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT</span>
<span class="c"># WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the</span>
<span class="c"># License for the specific language governing permissions and limitations</span>
<span class="c"># under the License.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">CoAP defines :coapsect:`a variety of options&lt;5.10&gt;` that affect</span>
<span class="sd">request and response semantics.  This module provides classes and</span>
<span class="sd">functions to operate on native Python instances of the options, and to</span>
<span class="sd">translate them between</span>
<span class="sd">the Python instances and their :coapsect:`encoded representation</span>
<span class="sd">within messages&lt;3.1&gt;`</span>

<span class="sd">:copyright: Copyright 2013, Peter A. Bigot</span>
<span class="sd">:license: Apache-2.0</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">unicode_literals</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="n">_log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">coapy</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">unicodedata</span>
<span class="kn">import</span> <span class="nn">coapy.util</span>


<div class="viewcode-block" id="OptionError"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.OptionError">[docs]</a><span class="k">class</span> <span class="nc">OptionError</span> <span class="p">(</span><span class="n">coapy</span><span class="o">.</span><span class="n">InfrastructureError</span><span class="p">):</span>
    <span class="k">pass</span>

</div>
<div class="viewcode-block" id="OptionRegistryConflictError"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.OptionRegistryConflictError">[docs]</a><span class="k">class</span> <span class="nc">OptionRegistryConflictError</span> <span class="p">(</span><span class="n">OptionError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Exception raised when option numbers collide.</span>

<span class="sd">    CoAPy requires that each subclass of :class:`UrOption` has a</span>
<span class="sd">    unique option number, enforced by registering the</span>
<span class="sd">    subclass when its type is defined.  Attempts to use the same</span>
<span class="sd">    number for multiple options produce this exception.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>

</div>
<div class="viewcode-block" id="InvalidOptionTypeError"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.InvalidOptionTypeError">[docs]</a><span class="k">class</span> <span class="nc">InvalidOptionTypeError</span> <span class="p">(</span><span class="n">OptionError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Exception raised when an option is incorrectly defined.</span>

<span class="sd">    Each subclass of :class:`UrOption` must override</span>
<span class="sd">    :attr:`UrOption.number` with the integer option number,</span>
<span class="sd">    :attr:`UrOption.name` with the Unicode option name,</span>
<span class="sd">    :attr:`UrOption.format` with the type of the option, and</span>
<span class="sd">    :attr:`UrOption._repeatable` with repeatability information.</span>
<span class="sd">    Failure to do so will cause this exception to be raised.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>

</div>
<div class="viewcode-block" id="OptionLengthError"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.OptionLengthError">[docs]</a><span class="k">class</span> <span class="nc">OptionLengthError</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">OptionError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Exception raised when a value&#39;s packed representation violates</span>
<span class="sd">    an option&#39;s length constraints, as determined by</span>
<span class="sd">    :attr:`UrOption.format`.&quot;&quot;&quot;</span>
    <span class="k">pass</span>

</div>
<div class="viewcode-block" id="OptionDecodeError"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.OptionDecodeError">[docs]</a><span class="k">class</span> <span class="nc">OptionDecodeError</span> <span class="p">(</span><span class="n">OptionError</span><span class="p">):</span>
    <span class="k">pass</span>

</div>
<div class="viewcode-block" id="UnrecognizedCriticalOptionError"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.UnrecognizedCriticalOptionError">[docs]</a><span class="k">class</span> <span class="nc">UnrecognizedCriticalOptionError</span> <span class="p">(</span><span class="n">OptionError</span><span class="p">):</span>
    <span class="k">pass</span>

</div>
<div class="viewcode-block" id="InvalidOptionError"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.InvalidOptionError">[docs]</a><span class="k">class</span> <span class="nc">InvalidOptionError</span> <span class="p">(</span><span class="n">OptionError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An option appears in a response or request when it must not.&quot;&quot;&quot;</span>
    <span class="k">pass</span>

</div>
<div class="viewcode-block" id="InvalidMultipleOptionError"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.InvalidMultipleOptionError">[docs]</a><span class="k">class</span> <span class="nc">InvalidMultipleOptionError</span> <span class="p">(</span><span class="n">InvalidOptionError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An option appears multiple times in a response or request when</span>
<span class="sd">    it must only appear once.&quot;&quot;&quot;</span>
    <span class="k">pass</span>

</div>
<div class="viewcode-block" id="_format_base"><a class="viewcode-back" href="../../coapy_option.html#coapy.option._format_base">[docs]</a><span class="k">class</span> <span class="nc">_format_base</span> <span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Abstract base for typed option value formatters.</span>

<span class="sd">    CoAP options encode values as byte sequences in one of several</span>
<span class="sd">    formats including:</span>

<span class="sd">    * :class:`format_empty` for no value</span>
<span class="sd">    * :class:`format_opaque` for uninterpreted byte sequences</span>
<span class="sd">    * :class:`format_uint` for variable-length unsigned integers</span>
<span class="sd">    * :class:`format_string` for Unicode text in Net-Unicode form</span>
<span class="sd">      (:rfc:`5198`).</span>

<span class="sd">    *max_length* is the maximum length of the packed representation in</span>
<span class="sd">    octets.  *min_length* is the minimum length of the packed</span>
<span class="sd">    representation in octets.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="_format_base._min_length"><a class="viewcode-back" href="../../coapy_option.html#coapy.option._format_base._min_length">[docs]</a>    <span class="k">def</span> <span class="nf">_min_length</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The minimum acceptable length of the packed representation,</span>
<span class="sd">        in octets.  This is a read-only property.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__min_length</span></div>
    <span class="n">min_length</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_min_length</span><span class="p">)</span>

<div class="viewcode-block" id="_format_base._max_length"><a class="viewcode-back" href="../../coapy_option.html#coapy.option._format_base._max_length">[docs]</a>    <span class="k">def</span> <span class="nf">_max_length</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The maximum acceptable length of the packed representation,</span>
<span class="sd">        in octets.  This is a read-only property.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__max_length</span></div>
    <span class="n">max_length</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_max_length</span><span class="p">)</span>

<div class="viewcode-block" id="_format_base._unpacked_type"><a class="viewcode-back" href="../../coapy_option.html#coapy.option._format_base._unpacked_type">[docs]</a>    <span class="k">def</span> <span class="nf">_unpacked_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The Python type used for unpacked values.  This is a</span>
<span class="sd">        read-only property.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_UnpackedType</span></div>
    <span class="n">unpacked_type</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_unpacked_type</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_length</span><span class="p">,</span> <span class="n">min_length</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__max_length</span> <span class="o">=</span> <span class="n">max_length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__min_length</span> <span class="o">=</span> <span class="n">min_length</span>

<div class="viewcode-block" id="_format_base.to_packed"><a class="viewcode-back" href="../../coapy_option.html#coapy.option._format_base.to_packed">[docs]</a>    <span class="k">def</span> <span class="nf">to_packed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert *value* to packed form.</span>

<span class="sd">        If *value* is not an instance of :attr:`unpacked_type` then</span>
<span class="sd">        :exc:`TypeError&lt;python:exceptions.typeError&gt;` will be raised</span>
<span class="sd">        with *value* as an argument.</span>

<span class="sd">        The return value is a :class:`bytes` object with a length</span>
<span class="sd">        between :attr:`min_length` and :attr:`max_length`.  If *value*</span>
<span class="sd">        results in a packed format that is not within these bounds,</span>
<span class="sd">        :exc:`OptionLengthError` will be raised with *value* as</span>
<span class="sd">        an argument.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpacked_type</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">pv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_packed</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pv</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_length</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_length</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">pv</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">OptionLengthError</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pv</span>
</div>
<div class="viewcode-block" id="_format_base._to_packed"><a class="viewcode-back" href="../../coapy_option.html#coapy.option._format_base._to_packed">[docs]</a>    <span class="k">def</span> <span class="nf">_to_packed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&#39;Virtual&#39; method implemented by subclasses to do</span>
<span class="sd">        type-specific packing.  The subclass implementation may assume</span>
<span class="sd">        *value* is of type :attr:`unpacked_type` and that the length</span>
<span class="sd">        constraints on the packed representation will be checked by</span>
<span class="sd">        :meth:`to_packed`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</div>
<div class="viewcode-block" id="_format_base.from_packed"><a class="viewcode-back" href="../../coapy_option.html#coapy.option._format_base.from_packed">[docs]</a>    <span class="k">def</span> <span class="nf">from_packed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">packed</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert *packed* to its unpacked form.</span>

<span class="sd">        If *packed* is not an instance of :class:`bytes` then</span>
<span class="sd">        :exc:`TypeError&lt;python:exceptions.TypeError&gt;` will be raised</span>
<span class="sd">        with *packed* as an argument.</span>

<span class="sd">        If the length of *packed* is not between :attr:`min_length`</span>
<span class="sd">        and :attr:`max_length` (both inclusive) then</span>
<span class="sd">        :exc:`OptionLengthError` will be raised with *packed* as</span>
<span class="sd">        an argument.</span>

<span class="sd">        Otherwise the value is unpacked and a corresponding instance</span>
<span class="sd">        of :attr:`unpacked_type` is returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">packed</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">packed</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">packed</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_length</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_length</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">packed</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">OptionLengthError</span><span class="p">(</span><span class="n">packed</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_packed</span><span class="p">(</span><span class="n">packed</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="_format_base._from_packed"><a class="viewcode-back" href="../../coapy_option.html#coapy.option._format_base._from_packed">[docs]</a>    <span class="k">def</span> <span class="nf">_from_packed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&#39;Virtual&#39; method implemented by subclasses to do</span>
<span class="sd">        type-specific unpacking.  The subclass implementation may</span>
<span class="sd">        assume *value* is of type :attr:`bytes` and that the length</span>
<span class="sd">        constraints on the packed representation have been checked.</span>
<span class="sd">        It must return an instance of :attr:`unpacked_type`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</div>
<div class="viewcode-block" id="_format_base.to_text"><a class="viewcode-back" href="../../coapy_option.html#coapy.option._format_base.to_text">[docs]</a>    <span class="k">def</span> <span class="nf">to_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert an :attr:`unpacked_type` *value* to a text</span>
<span class="sd">        (unicode) string holding a user-readable representation of the</span>
<span class="sd">        value.</span>

<span class="sd">        This function does not validate length constraints on the</span>
<span class="sd">        value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpacked_type</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_text</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="_format_base._to_text"><a class="viewcode-back" href="../../coapy_option.html#coapy.option._format_base._to_text">[docs]</a>    <span class="k">def</span> <span class="nf">_to_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&#39;Virtual&#39; method implemented by subclasses to represent the</span>
<span class="sd">        given value known to be in type :attr:`unpacked_type`.  Return</span>
<span class="sd">        the text value as required by :meth:`to_text`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

</div></div>
<div class="viewcode-block" id="format_empty"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.format_empty">[docs]</a><span class="k">class</span> <span class="nc">format_empty</span> <span class="p">(</span><span class="n">_format_base</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Support options with no value.</span>

<span class="sd">    The only acceptable value is a zero-length byte string.  This is</span>
<span class="sd">    both the packed and unpacked value.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_UnpackedType</span> <span class="o">=</span> <span class="nb">bytes</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">format_empty</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_to_packed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">_from_packed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">_to_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span>

</div>
<div class="viewcode-block" id="format_opaque"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.format_opaque">[docs]</a><span class="k">class</span> <span class="nc">format_opaque</span> <span class="p">(</span><span class="n">_format_base</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Support options with opaque values.</span>

<span class="sd">    Unpacked values are instances of :class:`bytes`, and packing and</span>
<span class="sd">    unpacking is an identity operation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_UnpackedType</span> <span class="o">=</span> <span class="nb">bytes</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_length</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">format_opaque</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">max_length</span><span class="p">,</span> <span class="n">min_length</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_to_packed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">_from_packed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">_to_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">coapy</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">to_display_text</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="format_uint"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.format_uint">[docs]</a><span class="k">class</span> <span class="nc">format_uint</span> <span class="p">(</span><span class="n">_format_base</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Supports options with variable-length unsigned integer values.</span>
<span class="sd">    *max_length* is the maximum number of octets in the packed format.</span>
<span class="sd">    The implicit *min_length* is always zero.</span>

<span class="sd">    Unpacked values are instances of :class:`int`.  The packed value is</span>
<span class="sd">    big-endian in a :class:`bytes` string with all zero-valued leading</span>
<span class="sd">    bytes removed.  Thus the packed representation of zero is an empty</span>
<span class="sd">    string.</span>

<span class="sd">    Per the CoAP specification packed values with leading NUL bytes</span>
<span class="sd">    will decode correctly; however, they are still subject to</span>
<span class="sd">    validation against :attr:`max_length`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_UnpackedType</span> <span class="o">=</span> <span class="nb">int</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_length</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">format_uint</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">max_length</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_to_packed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">==</span> <span class="n">value</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">b</span><span class="s">&#39;&#39;</span>
        <span class="n">pv</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s">&#39;!Q&#39;</span><span class="p">),</span> <span class="n">value</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pv</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">pv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">pv</span><span class="p">[</span><span class="n">i</span><span class="p">:])</span>

    <span class="k">def</span> <span class="nf">_from_packed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span> <span class="o">*</span> <span class="mi">256</span><span class="p">)</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">option_encoding</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">13</span><span class="p">:</span>
            <span class="n">ov</span> <span class="o">=</span> <span class="n">value</span>
            <span class="n">ovx</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;&#39;</span>
        <span class="k">elif</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">269</span><span class="p">:</span>
            <span class="n">ov</span> <span class="o">=</span> <span class="mi">13</span>
            <span class="n">ovx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_packed</span><span class="p">(</span><span class="n">value</span> <span class="o">-</span> <span class="mi">13</span><span class="p">)</span>
            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">ovx</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">ovx</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">ovx</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ov</span> <span class="o">=</span> <span class="mi">14</span>
            <span class="n">ovx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_packed</span><span class="p">(</span><span class="n">value</span> <span class="o">-</span> <span class="mi">269</span><span class="p">)</span>
            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">ovx</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">ovx</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">ovx</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">ov</span><span class="p">,</span> <span class="n">ovx</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">option_decoding</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ov</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="mi">15</span> <span class="o">&lt;=</span> <span class="n">ov</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">ov</span><span class="p">)</span>
        <span class="k">if</span> <span class="mi">14</span> <span class="o">==</span> <span class="n">ov</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="mi">269</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_packed</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="mi">2</span><span class="p">]),</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
        <span class="k">if</span> <span class="mi">13</span> <span class="o">==</span> <span class="n">ov</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="mi">13</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_packed</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="mi">1</span><span class="p">]),</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">ov</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_to_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;{0:d}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="format_string"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.format_string">[docs]</a><span class="k">class</span> <span class="nc">format_string</span> <span class="p">(</span><span class="n">_format_base</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Supports options with text values.</span>

<span class="sd">    Unpacked values are Python Unicode (text) strings.  Packed values</span>
<span class="sd">    are :class:`bytes` in Net-Unicode form (:rfc:`5198`), a</span>
<span class="sd">    canonicalized ``utf-8`` encoding.  Note that, as usual, the</span>
<span class="sd">    *max_length* and *min_length* attributes apply to the packed</span>
<span class="sd">    representation, which for non-ASCII text may be longer than the</span>
<span class="sd">    unpacked representation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_UnpackedType</span> <span class="o">=</span> <span class="nb">unicode</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_length</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">format_string</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">max_length</span><span class="p">,</span> <span class="n">min_length</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_to_packed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">coapy</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">to_net_unicode</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_from_packed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">rv</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rv</span>

    <span class="k">def</span> <span class="nf">_to_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span>
</div>
<span class="n">_OptionRegistry</span> <span class="o">=</span> <span class="p">{}</span>


<span class="c"># Internal function used to register option classes as their</span>
<span class="c"># definitions are processed by Python.</span>
<span class="k">def</span> <span class="nf">_register_option</span><span class="p">(</span><span class="n">option_class</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">option_class</span><span class="p">,</span> <span class="n">UrOption</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InvalidOptionTypeError</span><span class="p">(</span><span class="n">option_class</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">option_class</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InvalidOptionTypeError</span><span class="p">(</span><span class="n">option_class</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">option_class</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InvalidOptionTypeError</span><span class="p">(</span><span class="n">option_class</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">((</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">option_class</span><span class="o">.</span><span class="n">number</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">option_class</span><span class="o">.</span><span class="n">number</span> <span class="o">&lt;=</span> <span class="mi">65535</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="n">InvalidOptionTypeError</span><span class="p">(</span><span class="n">option_class</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">option_class</span><span class="o">.</span><span class="n">format</span><span class="p">,</span> <span class="n">_format_base</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InvalidOptionTypeError</span><span class="p">(</span><span class="n">option_class</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">option_class</span><span class="o">.</span><span class="n">_repeatable</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>
            <span class="ow">and</span> <span class="p">(</span><span class="mi">2</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">option_class</span><span class="o">.</span><span class="n">_repeatable</span><span class="p">))):</span>
        <span class="k">raise</span> <span class="n">InvalidOptionTypeError</span><span class="p">(</span><span class="n">option_class</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">option_class</span><span class="o">.</span><span class="n">_repeatable</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">((</span><span class="n">v</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">InvalidOptionTypeError</span><span class="p">(</span><span class="n">option_class</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">option_class</span><span class="o">.</span><span class="n">number</span> <span class="ow">in</span> <span class="n">_OptionRegistry</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">OptionRegistryConflictError</span><span class="p">(</span><span class="n">option_class</span><span class="p">)</span>
    <span class="n">_OptionRegistry</span><span class="p">[</span><span class="n">option_class</span><span class="o">.</span><span class="n">number</span><span class="p">]</span> <span class="o">=</span> <span class="n">option_class</span>
    <span class="k">return</span> <span class="n">option_class</span>


<div class="viewcode-block" id="find_option"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.find_option">[docs]</a><span class="k">def</span> <span class="nf">find_option</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Look up an option by number.</span>

<span class="sd">    Returns the :class:`UrOption` subclass registered for *number*,</span>
<span class="sd">    or ``None`` if no such option has been registered.  *number* must</span>
<span class="sd">    be an :class:`int` in the range 0 through 65535.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">((</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">number</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">number</span> <span class="o">&lt;=</span> <span class="mi">65535</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_OptionRegistry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="all_options"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.all_options">[docs]</a><span class="k">def</span> <span class="nf">all_options</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Return an iterable producing all registered options.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_OptionRegistry</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>


<span class="c"># Meta class used to enforce constraints on option types.  This serves</span>
<span class="c"># several purposes:</span>
<span class="c">#</span>
<span class="c"># * It ensures that each subclass of UrOption properly provides both a</span>
<span class="c">#   number and a format attribute;</span>
<span class="c">#</span>
<span class="c"># * It verifies that the values of these attributes are consistent with</span>
<span class="c">#   the specification;</span>
<span class="c">#</span>
<span class="c"># * It rewrites the subclass so that those attributes are read-only in</span>
<span class="c">#   both class and instance forms;</span>
<span class="c">#</span>
<span class="c"># * It registers each option class so that it can be looked up by</span>
<span class="c">#   number.</span>
<span class="c">#</span>
<span class="c"># The concepts in this approach derive from:</span>
<span class="c"># http://stackoverflow.com/questions/1735434/class-level-read-only-properties-in-python</span>
<span class="c">#</span>
<span class="c"># Note that coapy.util.ReadOnlyMeta does something similar but only to</span>
<span class="c"># the class in which the attribute is introduced, while this works only</span>
<span class="c"># on subclasses of UrOption.</span></div>
<span class="k">class</span> <span class="nc">_MetaUrOption</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>

    <span class="c"># This class must do its work before UrOption has been added to</span>
    <span class="c"># the module namespace.  Once that&#39;s been done this will be a</span>
    <span class="c"># reference to it.</span>
    <span class="n">__UrOption</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c"># The set of attributes in types that are to be made immutable if</span>
    <span class="c"># the type provides a non-None value for the attribute.</span>
    <span class="n">__ReadOnlyAttrs</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;number&#39;</span><span class="p">,</span> <span class="s">&#39;_repeatable&#39;</span><span class="p">,</span> <span class="s">&#39;format&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">SetUrOption</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">ur_option</span><span class="p">):</span>
        <span class="n">cls</span><span class="o">.</span><span class="n">__UrOption</span> <span class="o">=</span> <span class="n">ur_option</span>

    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">):</span>
        <span class="c"># Provide a unique type that can hold the immutable class</span>
        <span class="c"># number and format values.</span>
        <span class="k">class</span> <span class="nc">UniqueUrOption</span> <span class="p">(</span><span class="n">cls</span><span class="p">):</span>
            <span class="k">pass</span>

        <span class="n">do_register</span> <span class="o">=</span> <span class="p">(</span><span class="n">cls</span><span class="o">.</span><span class="n">__UrOption</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span> <span class="n">namespace</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;_RegisterOption&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>

        <span class="c"># Only subclasses of UrOption have read-only attributes.  Make</span>
        <span class="c"># those attributes immutable at both the class and instance</span>
        <span class="c"># levels.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">cls</span><span class="o">.</span><span class="n">__UrOption</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">cls</span><span class="o">.</span><span class="n">__ReadOnlyAttrs</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">namespace</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">property</span><span class="p">):</span>
                    <span class="n">mp</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="k">lambda</span> <span class="n">self_or_cls</span><span class="p">,</span> <span class="n">_v</span><span class="o">=</span><span class="n">v</span><span class="p">:</span> <span class="n">_v</span><span class="p">)</span>
                    <span class="n">namespace</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">mp</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">UniqueUrOption</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">mp</span><span class="p">)</span>

        <span class="c"># Create the subclass type, and register it if it&#39;s complete</span>
        <span class="c"># (and not UrOption).</span>
        <span class="n">mcls</span> <span class="o">=</span> <span class="nb">type</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">UniqueUrOption</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">do_register</span><span class="p">:</span>
            <span class="n">_register_option</span><span class="p">(</span><span class="n">mcls</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">mcls</span>


<div class="viewcode-block" id="is_critical_option"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.is_critical_option">[docs]</a><span class="k">def</span> <span class="nf">is_critical_option</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return ``True`` iff *number* identifies a critical option.</span>

<span class="sd">    A :coapsect:`critical option&lt;5.4.1&gt;` is one that must be</span>
<span class="sd">    understood by the endpoint processing the message.  This is</span>
<span class="sd">    indicated by bit 0 (0x01) of the *number* being set.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">number</span> <span class="o">&amp;</span> <span class="mi">1</span>

</div>
<div class="viewcode-block" id="is_unsafe_option"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.is_unsafe_option">[docs]</a><span class="k">def</span> <span class="nf">is_unsafe_option</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return ``True`` iff the option number identifies an unsafe option.</span>

<span class="sd">    An :coapsect:`unsafe option&lt;5.4.2&gt;` is one that must be recognized</span>
<span class="sd">    by a proxy in order to safely forward (or cache) the message.</span>
<span class="sd">    This is indicated by bit 1 (0x02) of the *number* being set.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">number</span> <span class="o">&amp;</span> <span class="mi">2</span>

</div>
<div class="viewcode-block" id="is_no_cache_key_option"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.is_no_cache_key_option">[docs]</a><span class="k">def</span> <span class="nf">is_no_cache_key_option</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return ``True`` iff the option number identifies a NoCacheKey option.</span>

<span class="sd">    A :coapsect:`NoCacheKey option&lt;5.4.2&gt;` is one for which the value</span>
<span class="sd">    of the option does not contribute to the key that identifies a</span>
<span class="sd">    matching value in a cache.  This is encoded in bits 1 through 5 of</span>
<span class="sd">    the *number*.  Options that are :func:`unsafe&lt;is_unsafe_option&gt;`</span>
<span class="sd">    are always NoCacheKey options.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="mh">0x1c</span> <span class="o">==</span> <span class="p">(</span><span class="n">number</span> <span class="o">&amp;</span> <span class="mh">0x1e</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="UrOption"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.UrOption">[docs]</a><span class="k">class</span> <span class="nc">UrOption</span> <span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Abstract base for CoAP options.</span>

<span class="sd">    If *unpacked_value* is not ``None``, :attr:`value` will be initialized</span>
<span class="sd">    with that value; otherwise if *packed_value* is not ``None``</span>
<span class="sd">    :attr:`value` will be initialized with the corresponding unpacked</span>
<span class="sd">    value; otherwise :attr:`value` will be ``None`` until a valid</span>
<span class="sd">    value is assigned.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">_MetaUrOption</span>

    <span class="n">number</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;The option number.</span>

<span class="sd">    An unsigned integer in the range 0..65535.  This is an</span>
<span class="sd">    IANA-registered value with the following policies</span>
<span class="sd">    (:rfc:`5226`):</span>

<span class="sd">    ============   ========</span>
<span class="sd">    Option Range   Policy</span>
<span class="sd">    ============   ========</span>
<span class="sd">        0..255     IETF Review or IESG Approval</span>
<span class="sd">      256..2047    Specification Required</span>
<span class="sd">     2048..64999   Designated Expert</span>
<span class="sd">    65000..65535   Reserved for experiments</span>
<span class="sd">    ============   ========</span>

<span class="sd">    The attribute is read-only.  Each subclass of :class:`UrOption` is</span>
<span class="sd">    registered during its definition.  :exc:`InvalidOptionType` will</span>
<span class="sd">    be raised if a previously-registered option exists with the same</span>
<span class="sd">    option number.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_repeatable</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;A tuple ``(request, response)`` indicating allowed</span>
<span class="sd">    cardinality of the option in requests and responses, respectively.</span>

<span class="sd">    The value of *request* and *response* is ``True`` if the option</span>
<span class="sd">    may appear multiple times in the corresponding message, ``False``</span>
<span class="sd">    if it must appear only once, and ``None`` if it may not appear at</span>
<span class="sd">    all.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">format</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;An instance of :class:`format_empty`, :class:`format_opaque`,</span>
<span class="sd">    :class:`format_uint`, or :class:`format_string`.  The instance is</span>
<span class="sd">    used to check that the :attr:`value` is acceptable for the</span>
<span class="sd">    option.&quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;A human-readable standard short name for the option, suitable</span>
<span class="sd">    for diagnostics.  This is a read-only attribute with a Unicode</span>
<span class="sd">    string value.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="UrOption.is_critical"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.UrOption.is_critical">[docs]</a>    <span class="k">def</span> <span class="nf">is_critical</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Passes ``self.number`` to :func:`is_critical_option`.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">is_critical_option</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="UrOption.is_unsafe"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.UrOption.is_unsafe">[docs]</a>    <span class="k">def</span> <span class="nf">is_unsafe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Passes ``self.number`` to :func:`is_unsafe_option`.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">is_unsafe_option</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="UrOption.is_no_cache_key"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.UrOption.is_no_cache_key">[docs]</a>    <span class="k">def</span> <span class="nf">is_no_cache_key</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Passes ``self.number`` to :func:`is_no_cache_key_option`.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">is_no_cache_key_option</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="UrOption.valid_in_request"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.UrOption.valid_in_request">[docs]</a>    <span class="k">def</span> <span class="nf">valid_in_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return ``True`` iff this option may appear at least once in a request message.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_repeatable</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="UrOption.valid_multiple_in_request"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.UrOption.valid_multiple_in_request">[docs]</a>    <span class="k">def</span> <span class="nf">valid_multiple_in_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return ``True`` iff this option may appear multiple times in a request message.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_repeatable</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="UrOption.valid_in_response"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.UrOption.valid_in_response">[docs]</a>    <span class="k">def</span> <span class="nf">valid_in_response</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return ``True`` iff this option may appear at least once in a response message.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_repeatable</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="UrOption.valid_multiple_in_response"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.UrOption.valid_multiple_in_response">[docs]</a>    <span class="k">def</span> <span class="nf">valid_multiple_in_response</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return ``True`` iff this option may appear multiple times in a response message.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_repeatable</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">True</span>
</div>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unpacked_value</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">packed_value</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">UrOption</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">unpacked_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_value</span><span class="p">(</span><span class="n">unpacked_value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">packed_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">from_packed</span><span class="p">(</span><span class="n">packed_value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__value</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">_set_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unpacked_value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">from_packed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">to_packed</span><span class="p">(</span><span class="n">unpacked_value</span><span class="p">))</span>

<div class="viewcode-block" id="UrOption._get_value"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.UrOption._get_value">[docs]</a>    <span class="k">def</span> <span class="nf">_get_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Contains the value of the option.  This is an instance of</span>
<span class="sd">        :attr:`format.unpacked_type&lt;_format_base.unpacked_type&gt;`.</span>
<span class="sd">        Only values that pass the restrictions of :attr:`format` may</span>
<span class="sd">        be assigned to this property.  Unacceptable values result in</span>
<span class="sd">        :exc:`TypeError&lt;python:exceptions.TypeError&gt;` or</span>
<span class="sd">        :exc:`OptionLengthError`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__value</span>
</div>
    <span class="n">value</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_value</span><span class="p">,</span> <span class="n">_set_value</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="UrOption.first_match"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.UrOption.first_match">[docs]</a>    <span class="k">def</span> <span class="nf">first_match</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the first option in *options* that&#39;s an instance of</span>
<span class="sd">        *cls*.</span>

<span class="sd">        Returns ``None`` if no option in the *options is an instance</span>
<span class="sd">        of *cls*.  Note that the test is specifically for instances of</span>
<span class="sd">        the class; an instance of :class:`UnrecognizedOption` will not</span>
<span class="sd">        be returned just because the :attr:`number` matches.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">cls</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">o</span>
        <span class="k">return</span> <span class="bp">None</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="UrOption.all_match"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.UrOption.all_match">[docs]</a>    <span class="k">def</span> <span class="nf">all_match</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the sub-sequence of options in *options* that are</span>
<span class="sd">        instances of *cls*.</span>

<span class="sd">        Note that the test is specifically for instances of the class;</span>
<span class="sd">        an instance of :class:`UnrecognizedOption` will not be</span>
<span class="sd">        returned just because the :attr:`number` matches.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rv</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">cls</span><span class="p">):</span>
                <span class="n">rv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rv</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="UrOption.packed_value"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.UrOption.packed_value">[docs]</a>    <span class="k">def</span> <span class="nf">packed_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The :attr:`value` of the option in its packed representation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">to_packed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">,</span> <span class="n">format_empty</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">to_text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="k">return</span> <span class="s">&#39;{0}: {1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&#39;{0}: &lt;??&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">__str__</span> <span class="o">=</span> <span class="n">__unicode__</span>


<span class="c"># Register the UrOption so subclasses can</span></div>
<span class="n">_MetaUrOption</span><span class="o">.</span><span class="n">SetUrOption</span><span class="p">(</span><span class="n">UrOption</span><span class="p">)</span>

<span class="c"># A utility instance used to encode and decode variable-length</span>
<span class="c"># integers in options, which comprise a 4-bit code with zero to two</span>
<span class="c"># bytes of offset.</span>
<span class="n">_optionint_helper</span> <span class="o">=</span> <span class="n">format_uint</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>


<div class="viewcode-block" id="sorted_options"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.sorted_options">[docs]</a><span class="k">def</span> <span class="nf">sorted_options</span><span class="p">(</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sort a sequence of options into canonical order.</span>

<span class="sd">    Return a list with the same elements as *options* sorted using the option</span>
<span class="sd">    :attr:`number&lt;UrOption.number&gt;` as the key.  The sort is stable:</span>
<span class="sd">    options with the same number remain in their original order.  This</span>
<span class="sd">    operation is used for duplicate detection and to calculate the</span>
<span class="sd">    delta required to encode options.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">_o</span><span class="p">:</span> <span class="n">_o</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="replace_unacceptable_options"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.replace_unacceptable_options">[docs]</a><span class="k">def</span> <span class="nf">replace_unacceptable_options</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">is_request</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Verify that a set of options passes CoAP requirements.</span>

<span class="sd">    Individual options have occurrence restrictions that are encoded</span>
<span class="sd">    within the options themselves and may be inspected by these</span>
<span class="sd">    methods:</span>

<span class="sd">        * :meth:`coapy.option.UrOption.valid_in_request`</span>
<span class="sd">        * :meth:`coapy.option.UrOption.valid_in_response`</span>
<span class="sd">        * :meth:`coapy.option.UrOption.valid_multiple_in_request`</span>
<span class="sd">        * :meth:`coapy.option.UrOption.valid_multiple_in_response`</span>

<span class="sd">    :coapsect:`5.4.5` specifies that options violating these</span>
<span class="sd">    constraints are to be interpreted as :class:`unrecognized</span>
<span class="sd">    options&lt;UnrecognizedOption&gt;`.  These are subsequently used to</span>
<span class="sd">    check for :coapsect:`critical&lt;5.4.1&gt;` or :coapsect:`unsafe&lt;5.7&gt;`</span>
<span class="sd">    options.</span>

<span class="sd">    This method replaces individual recognized options in</span>
<span class="sd">    :attr:`options` with an equivalent unrecognized option instance</span>
<span class="sd">    based on *is_request* and each option&#39;s restrictions.  The</span>
<span class="sd">    resulting list of options is returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">newopts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">is_request</span><span class="p">:</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">_o</span><span class="p">:</span> <span class="n">_o</span><span class="o">.</span><span class="n">valid_in_request</span><span class="p">()</span>
        <span class="n">valid_multiple</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">_o</span><span class="p">:</span> <span class="n">_o</span><span class="o">.</span><span class="n">valid_multiple_in_request</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">_o</span><span class="p">:</span> <span class="n">_o</span><span class="o">.</span><span class="n">valid_in_response</span><span class="p">()</span>
        <span class="n">valid_multiple</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">_o</span><span class="p">:</span> <span class="n">_o</span><span class="o">.</span><span class="n">valid_multiple_in_response</span><span class="p">()</span>
    <span class="n">last_number</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="n">sorted_options</span><span class="p">(</span><span class="n">options</span><span class="p">):</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">number</span> <span class="o">-</span> <span class="n">last_number</span>
        <span class="n">last_number</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">number</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">(</span><span class="n">opt</span><span class="p">):</span>
            <span class="n">newopts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">UnrecognizedOption</span><span class="o">.</span><span class="n">from_option</span><span class="p">(</span><span class="n">opt</span><span class="p">))</span>
        <span class="k">elif</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="n">delta</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">valid_multiple</span><span class="p">(</span><span class="n">opt</span><span class="p">):</span>
            <span class="n">newopts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">UnrecognizedOption</span><span class="o">.</span><span class="n">from_option</span><span class="p">(</span><span class="n">opt</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">newopts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">newopts</span>

</div>
<div class="viewcode-block" id="encode_options"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.encode_options">[docs]</a><span class="k">def</span> <span class="nf">encode_options</span><span class="p">(</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Encode a set of options into packed form.</span>

<span class="sd">    This returns a :class:`bytes` object that represents the encoding</span>
<span class="sd">    of *options* after they have been :func:`sorted&lt;sorted_options&gt;`.</span>
<span class="sd">    It may raise an exception if an option&#39;s value cannot be encoded,</span>
<span class="sd">    but performs no semantic</span>
<span class="sd">    validation.&quot;&quot;&quot;</span>
    <span class="n">last_number</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">packed</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="n">sorted_options</span><span class="p">(</span><span class="n">options</span><span class="p">):</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">number</span> <span class="o">-</span> <span class="n">last_number</span>
        <span class="n">last_number</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">number</span>
        <span class="n">pvalue</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">packed_value</span>
        <span class="p">(</span><span class="n">od</span><span class="p">,</span> <span class="n">odx</span><span class="p">)</span> <span class="o">=</span> <span class="n">_optionint_helper</span><span class="o">.</span><span class="n">option_encoding</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span>
        <span class="p">(</span><span class="n">ol</span><span class="p">,</span> <span class="n">olx</span><span class="p">)</span> <span class="o">=</span> <span class="n">_optionint_helper</span><span class="o">.</span><span class="n">option_encoding</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pvalue</span><span class="p">))</span>
        <span class="n">encoded</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="s">&#39;B&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">od</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="n">ol</span><span class="p">)</span>
        <span class="n">encoded</span> <span class="o">+=</span> <span class="n">odx</span> <span class="o">+</span> <span class="n">olx</span> <span class="o">+</span> <span class="n">pvalue</span>
        <span class="n">packed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">encoded</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">b</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">packed</span><span class="p">)</span>

</div>
<span class="k">def</span> <span class="nf">_decode_one_option</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">if</span> <span class="mh">0xFF</span> <span class="o">==</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="n">odl</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">od</span> <span class="o">=</span> <span class="p">(</span><span class="n">odl</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">ol</span> <span class="o">=</span> <span class="p">(</span><span class="n">odl</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="mi">15</span> <span class="o">==</span> <span class="n">od</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="mi">15</span> <span class="o">==</span> <span class="n">ol</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">OptionDecodeError</span><span class="p">(</span><span class="n">odl</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
    <span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="o">=</span> <span class="n">_optionint_helper</span><span class="o">.</span><span class="n">option_decoding</span><span class="p">(</span><span class="n">od</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="o">=</span> <span class="n">_optionint_helper</span><span class="o">.</span><span class="n">option_decoding</span><span class="p">(</span><span class="n">ol</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>


<div class="viewcode-block" id="decode_options"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.decode_options">[docs]</a><span class="k">def</span> <span class="nf">decode_options</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Extract a list of options from the packed *data* which is :class:`bytes`.</span>

<span class="sd">    Returns ``(options, remaining_data)`` where *options* is a list of</span>
<span class="sd">    instances of subclasses of :class:`UrOption`.  Options that are</span>
<span class="sd">    unknown to the infrastructure will be returned as instances of</span>
<span class="sd">    :class:`UnrecognizedOption`.  *remaining_data* will be the suffix of</span>
<span class="sd">    *data* that was not consumed when unpacking the options.</span>

<span class="sd">    This will raise :exc:`OptionDecodeError` or other exceptions if</span>
<span class="sd">    the option data is malformed, but does no semantic validation&quot;&quot;&quot;</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">option_number</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">options</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">data</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>      <span class="c"># avoid 2to3 ord/chr issues</span>
    <span class="k">while</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="o">=</span> <span class="n">_decode_one_option</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">delta</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">option_number</span> <span class="o">+=</span> <span class="n">delta</span>
        <span class="n">option_type</span> <span class="o">=</span> <span class="n">find_option</span><span class="p">(</span><span class="n">option_number</span><span class="p">)</span>
        <span class="n">packed</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="n">length</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">length</span><span class="p">:]</span>
        <span class="n">opt</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">option_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">opt</span> <span class="o">=</span> <span class="n">option_type</span><span class="p">(</span><span class="n">packed_value</span><span class="o">=</span><span class="n">packed</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">OptionLengthError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">if</span> <span class="n">opt</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">opt</span> <span class="o">=</span> <span class="n">UnrecognizedOption</span><span class="p">(</span><span class="n">option_number</span><span class="p">,</span> <span class="n">packed_value</span><span class="o">=</span><span class="n">packed</span><span class="p">)</span>
        <span class="n">options</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span>
    <span class="k">if</span> <span class="mi">0</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">options</span><span class="p">):</span>
        <span class="n">options</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="UnrecognizedOption"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.UnrecognizedOption">[docs]</a><span class="k">class</span> <span class="nc">UnrecognizedOption</span> <span class="p">(</span><span class="n">UrOption</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Contains an option for which the registered :class:`UrOption`</span>
<span class="sd">    subclass is not available or may not be used.</span>

<span class="sd">    *number* must be provided, must be in the range 0 through 65535.</span>
<span class="sd">    *unpacked_value* and *packed_value* operate as in</span>
<span class="sd">    :class:`UrOption` and accept only :class:`bytes` objects.</span>

<span class="sd">    :class:`UnrecognizedOption` instances are structurally accepted in</span>
<span class="sd">    both request and response messages and instances with the same</span>
<span class="sd">    :attr:`number` may appear multiple times in each.  Semantic</span>
<span class="sd">    restrictions may apply based on :meth:`UrOption.is_critical`.</span>

<span class="sd">    .. note::</span>

<span class="sd">       :coapsect:`5.4` specifies situations where an option must be</span>
<span class="sd">       treated as an unrecognized option even if its number matches a</span>
<span class="sd">       recognized option.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_RegisterOption</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">_repeatable</span> <span class="o">=</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="n">format</span> <span class="o">=</span> <span class="n">format_opaque</span><span class="p">(</span><span class="mi">1034</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;Unknown options carry their payload as uninterpreted</span>
<span class="sd">    :class:`bytes` objects with a maximum length of 1034 octets.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="UnrecognizedOption._get_number"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.UnrecognizedOption._get_number">[docs]</a>    <span class="k">def</span> <span class="nf">_get_number</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The :attr:`option number&lt;UrOption.number&gt;` associated with</span>
<span class="sd">        this option.  This is a read-only attribute.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__number</span></div>
    <span class="n">number</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_number</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;UnrecognizedOption&lt;{0:d}&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">unpacked_value</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">packed_value</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&gt;</span> <span class="n">number</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="mi">65535</span> <span class="o">&lt;</span> <span class="n">number</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__number</span> <span class="o">=</span> <span class="n">number</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">UnrecognizedOption</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">unpacked_value</span><span class="o">=</span><span class="n">unpacked_value</span><span class="p">,</span>
                                                 <span class="n">packed_value</span><span class="o">=</span><span class="n">packed_value</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="UnrecognizedOption.from_option"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.UnrecognizedOption.from_option">[docs]</a>    <span class="k">def</span> <span class="nf">from_option</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">opt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create an :class:`UnrecognizedOption` from an existing (recognized) option.</span>

<span class="sd">        This conversion is necessary per :coapsect:`5.4` in various</span>
<span class="sd">        instances where the recognized option is not accepted.</span>
<span class="sd">        Standard option processing then proceeds with the option left</span>
<span class="sd">        unrecognized.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="n">opt</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">opt</span><span class="o">.</span><span class="n">packed_value</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="IfMatch"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.IfMatch">[docs]</a><span class="k">class</span> <span class="nc">IfMatch</span> <span class="p">(</span><span class="n">UrOption</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Option used to make requests conditional on an :class:`ETag`</span>
<span class="sd">    match.  See :coapsect:`5.10.8.1`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">number</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">_repeatable</span> <span class="o">=</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="n">format</span> <span class="o">=</span> <span class="n">format_opaque</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;If-Match&#39;</span>

</div>
<div class="viewcode-block" id="UriHost"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.UriHost">[docs]</a><span class="k">class</span> <span class="nc">UriHost</span> <span class="p">(</span><span class="n">UrOption</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Option encoding the Internet host of a requested resource.  See</span>
<span class="sd">    :coapsect:`5.10.1`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">number</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">_repeatable</span> <span class="o">=</span> <span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="n">format</span> <span class="o">=</span> <span class="n">format_string</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;Uri-Host&#39;</span>

</div>
<div class="viewcode-block" id="ETag"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.ETag">[docs]</a><span class="k">class</span> <span class="nc">ETag</span> <span class="p">(</span><span class="n">UrOption</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Option used for a resource-local short-hand for a given</span>
<span class="sd">    representation of a resource.  See :coapsect:`5.10.6`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">number</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">_repeatable</span> <span class="o">=</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
    <span class="n">format</span> <span class="o">=</span> <span class="n">format_opaque</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;ETag&#39;</span>

</div>
<div class="viewcode-block" id="IfNoneMatch"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.IfNoneMatch">[docs]</a><span class="k">class</span> <span class="nc">IfNoneMatch</span> <span class="p">(</span><span class="n">UrOption</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Option used to make requests conditional absence of a resource.</span>
<span class="sd">    See :coapsect:`5.10.8.2`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">number</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">_repeatable</span> <span class="o">=</span> <span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="n">format</span> <span class="o">=</span> <span class="n">format_empty</span><span class="p">()</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;If-None-Match&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unpacked_value</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">packed_value</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">unpacked_value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">packed_value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">unpacked_value</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;&#39;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">IfNoneMatch</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">unpacked_value</span><span class="o">=</span><span class="n">unpacked_value</span><span class="p">,</span>
                                          <span class="n">packed_value</span><span class="o">=</span><span class="n">packed_value</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="UriPort"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.UriPort">[docs]</a><span class="k">class</span> <span class="nc">UriPort</span> <span class="p">(</span><span class="n">UrOption</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Option encoding the transport-layer port of a requested</span>
<span class="sd">    resource.  See :coapsect:`5.10.1`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">number</span> <span class="o">=</span> <span class="mi">7</span>
    <span class="n">_repeatable</span> <span class="o">=</span> <span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="n">format</span> <span class="o">=</span> <span class="n">format_uint</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;Uri-Port&#39;</span>

</div>
<div class="viewcode-block" id="LocationPath"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.LocationPath">[docs]</a><span class="k">class</span> <span class="nc">LocationPath</span> <span class="p">(</span><span class="n">UrOption</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Option encoding (a segment of) the path of a resource</span>
<span class="sd">    identified in a response.  This option may occur multiple times.</span>
<span class="sd">    See :coapsect:`5.10.7`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">number</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">_repeatable</span> <span class="o">=</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="n">format</span> <span class="o">=</span> <span class="n">format_string</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;Location-Path&#39;</span>

</div>
<div class="viewcode-block" id="UriPath"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.UriPath">[docs]</a><span class="k">class</span> <span class="nc">UriPath</span> <span class="p">(</span><span class="n">UrOption</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Option encoding (a segment of) the path of a requested</span>
<span class="sd">    resource.  This option may occur multiple times.  See</span>
<span class="sd">    :coapsect:`5.10.1`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">number</span> <span class="o">=</span> <span class="mi">11</span>
    <span class="n">_repeatable</span> <span class="o">=</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="n">format</span> <span class="o">=</span> <span class="n">format_string</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;Uri-Path&#39;</span>

</div>
<div class="viewcode-block" id="ContentFormat"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.ContentFormat">[docs]</a><span class="k">class</span> <span class="nc">ContentFormat</span> <span class="p">(</span><span class="n">UrOption</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Option encoding the representation format of the message</span>
<span class="sd">    payload.  See :coapsect:`5.10.3`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">number</span> <span class="o">=</span> <span class="mi">12</span>
    <span class="n">_repeatable</span> <span class="o">=</span> <span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
    <span class="n">format</span> <span class="o">=</span> <span class="n">format_uint</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;Content-Format&#39;</span>

</div>
<div class="viewcode-block" id="MaxAge"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.MaxAge">[docs]</a><span class="k">class</span> <span class="nc">MaxAge</span> <span class="p">(</span><span class="n">UrOption</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Option encoding the maximum time (in seconds) that a response</span>
<span class="sd">    may be cached before it is outdated.  See :coapsect:`5.10.5`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">number</span> <span class="o">=</span> <span class="mi">14</span>
    <span class="n">_repeatable</span> <span class="o">=</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
    <span class="n">format</span> <span class="o">=</span> <span class="n">format_uint</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;Max-Age&#39;</span>

</div>
<div class="viewcode-block" id="UriQuery"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.UriQuery">[docs]</a><span class="k">class</span> <span class="nc">UriQuery</span> <span class="p">(</span><span class="n">UrOption</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Option encoding (an element of) the query part of a requested</span>
<span class="sd">    resource.  This option may occur multiple times.  See</span>
<span class="sd">    :coapsect:`5.10.1`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">number</span> <span class="o">=</span> <span class="mi">15</span>
    <span class="n">_repeatable</span> <span class="o">=</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="n">format</span> <span class="o">=</span> <span class="n">format_string</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;Uri-Query&#39;</span>

</div>
<div class="viewcode-block" id="Accept"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.Accept">[docs]</a><span class="k">class</span> <span class="nc">Accept</span> <span class="p">(</span><span class="n">UrOption</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Option encoding the representation format acceptable to a</span>
<span class="sd">    client.  See :coapsect:`5.10.4`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">number</span> <span class="o">=</span> <span class="mi">17</span>
    <span class="n">_repeatable</span> <span class="o">=</span> <span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="n">format</span> <span class="o">=</span> <span class="n">format_uint</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;Accept&#39;</span>

</div>
<div class="viewcode-block" id="LocationQuery"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.LocationQuery">[docs]</a><span class="k">class</span> <span class="nc">LocationQuery</span> <span class="p">(</span><span class="n">UrOption</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Option encoding (an element of) the query part of a resource</span>
<span class="sd">    identified in a response.  This option may occur multiple times.</span>
<span class="sd">    See :coapsect:`5.10.7`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">number</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="n">_repeatable</span> <span class="o">=</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="n">format</span> <span class="o">=</span> <span class="n">format_string</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;Location-Query&#39;</span>

</div>
<div class="viewcode-block" id="ProxyUri"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.ProxyUri">[docs]</a><span class="k">class</span> <span class="nc">ProxyUri</span> <span class="p">(</span><span class="n">UrOption</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Option encoding the URI of a request directed through a</span>
<span class="sd">    :coapsect:`forward-proxy&lt;5.7&gt;`. See :coapsect:`5.10.2`.</span>

<span class="sd">    If this option appears in a request, none of :class:`UriHost`,</span>
<span class="sd">    :class:`UriPort`, :class:`UriPath`, or :class:`UriQuery` may</span>
<span class="sd">    appear.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">number</span> <span class="o">=</span> <span class="mi">35</span>
    <span class="n">_repeatable</span> <span class="o">=</span> <span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="n">format</span> <span class="o">=</span> <span class="n">format_string</span><span class="p">(</span><span class="mi">1034</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;Proxy-Uri&#39;</span>

</div>
<div class="viewcode-block" id="ProxyScheme"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.ProxyScheme">[docs]</a><span class="k">class</span> <span class="nc">ProxyScheme</span> <span class="p">(</span><span class="n">UrOption</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Option encoding the schema for a URI of a request directed</span>
<span class="sd">    through a :coapsect:`forward-proxy&lt;5.7&gt;`.  In this case the</span>
<span class="sd">    remainder of the URI is constructed from :class:`UriHost`,</span>
<span class="sd">    :class:`UriPort`, :class:`UriPath`, or :class:`UriQuery` options.</span>
<span class="sd">    See :coapsect:`5.10.2`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">number</span> <span class="o">=</span> <span class="mi">39</span>
    <span class="n">_repeatable</span> <span class="o">=</span> <span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="n">format</span> <span class="o">=</span> <span class="n">format_string</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;Proxy-Scheme&#39;</span>

</div>
<div class="viewcode-block" id="Size1"><a class="viewcode-back" href="../../coapy_option.html#coapy.option.Size1">[docs]</a><span class="k">class</span> <span class="nc">Size1</span> <span class="p">(</span><span class="n">UrOption</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Option providing size (in bytes) of a resource representation</span>
<span class="sd">    in a request.  It may appear in an informational role in a</span>
<span class="sd">    diagnostic response.  See :coapsect:`5.10.9`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">number</span> <span class="o">=</span> <span class="mi">60</span>
    <span class="n">_repeatable</span> <span class="o">=</span> <span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
    <span class="n">format</span> <span class="o">=</span> <span class="n">format_uint</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;Size1&#39;</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">CoAPy 0.0.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li>
          <li><a href="../coapy.html" >coapy</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Peter A. Bigot.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>