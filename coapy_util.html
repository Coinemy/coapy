

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>coapy.util &mdash; CoAPy 0.0.0 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="CoAPy 0.0.0 documentation" href="index.html" />
    <link rel="up" title="API" href="api.html" />
    <link rel="next" title="coapy.httputil" href="coapy_httputil.html" />
    <link rel="prev" title="coapy.endpoint" href="coapy_endpoint.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="coapy_httputil.html" title="coapy.httputil"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="coapy_endpoint.html" title="coapy.endpoint"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">CoAPy 0.0.0 documentation</a> &raquo;</li>
          <li><a href="api.html" accesskey="U">API</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="module-coapy.util">
<span id="coapy-util"></span><h1>coapy.util<a class="headerlink" href="#module-coapy.util" title="Permalink to this headline">¶</a></h1>
<p>Utility classes and functions used within CoAPy.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">copyright:</th><td class="field-body">Copyright 2013, Peter A. Bigot</td>
</tr>
<tr class="field-even field"><th class="field-name">license:</th><td class="field-body">Apache-2.0</td>
</tr>
</tbody>
</table>
<dl class="class">
<dt id="coapy.util.ReadOnlyMeta">
<em class="property">class </em><tt class="descclassname">coapy.util.</tt><tt class="descname">ReadOnlyMeta</tt><a class="reference internal" href="_modules/coapy/util.html#ReadOnlyMeta"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#coapy.util.ReadOnlyMeta" title="Permalink to this definition">¶</a></dt>
<dd><p>Metaclass for supporting read-only values in classes.</p>
<p>When used as a metaclass, this inserts an intermediary type that
prevents assignment to certain attributes at both the instance and
class levels.  Any attribute in the class that is initialized in
the class body with a value of type <a class="reference internal" href="#coapy.util.ClassReadOnly" title="coapy.util.ClassReadOnly"><tt class="xref py py-class docutils literal"><span class="pre">ClassReadOnly</span></tt></a> is made
read-only.</p>
<p>See example at <a class="reference internal" href="#coapy.util.ClassReadOnly" title="coapy.util.ClassReadOnly"><tt class="xref py py-class docutils literal"><span class="pre">ClassReadOnly</span></tt></a>.</p>
</dd></dl>

<dl class="class">
<dt id="coapy.util.ClassReadOnly">
<em class="property">class </em><tt class="descclassname">coapy.util.</tt><tt class="descname">ClassReadOnly</tt><big>(</big><em>value</em><big>)</big><a class="reference internal" href="_modules/coapy/util.html#ClassReadOnly"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#coapy.util.ClassReadOnly" title="Permalink to this definition">¶</a></dt>
<dd><p>A marker to indicate an attribute of a class should be
read-only within the class as well as instances of the class.</p>
<p>Effective only if the metaclass is (or is derived from)
<a class="reference internal" href="#coapy.util.ReadOnlyMeta" title="coapy.util.ReadOnlyMeta"><tt class="xref py py-class docutils literal"><span class="pre">ReadOnlyMeta</span></tt></a>.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="n">Object</span><span class="p">):</span>
    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">ReadOnlyMeta</span>

    <span class="n">Zero</span> <span class="o">=</span> <span class="n">ClassReadOnly</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">instance</span> <span class="o">=</span> <span class="n">C</span><span class="p">()</span>
<span class="k">assert</span> <span class="mi">0</span> <span class="o">==</span> <span class="n">C</span><span class="o">.</span><span class="n">Zero</span>
<span class="k">assert</span> <span class="mi">0</span> <span class="o">==</span> <span class="n">instance</span><span class="o">.</span><span class="n">Zero</span>

<span class="c"># This will raise an exception:</span>
<span class="n">C</span><span class="o">.</span><span class="n">Zero</span> <span class="o">=</span> <span class="mi">4</span>
<span class="c"># As will this:</span>
<span class="n">instance</span><span class="o">.</span><span class="n">Zero</span> <span class="o">=</span> <span class="mi">4</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="coapy.util.TimeDueOrdinal">
<em class="property">class </em><tt class="descclassname">coapy.util.</tt><tt class="descname">TimeDueOrdinal</tt><big>(</big><em>*args</em>, <em>**kw</em><big>)</big><a class="reference internal" href="_modules/coapy/util.html#TimeDueOrdinal"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#coapy.util.TimeDueOrdinal" title="Permalink to this definition">¶</a></dt>
<dd><p>Base class for elements that are sorted by time.</p>
<p>The intent is that information related to an activity that should
occur at or after a particular time be held in a subclass of
<a class="reference internal" href="#coapy.util.TimeDueOrdinal" title="coapy.util.TimeDueOrdinal"><tt class="xref py py-class docutils literal"><span class="pre">TimeDueOrdinal</span></tt></a>.  The priority queue of upcoming activity
is implemented using a sorted list, as instances of (subclasses
of) <a class="reference internal" href="#coapy.util.TimeDueOrdinal" title="coapy.util.TimeDueOrdinal"><tt class="xref py py-class docutils literal"><span class="pre">TimeDueOrdinal</span></tt></a> are ordered by increasing value of
<a class="reference internal" href="#coapy.util.TimeDueOrdinal.time_due" title="coapy.util.TimeDueOrdinal.time_due"><tt class="xref py py-attr docutils literal"><span class="pre">time_due</span></tt></a> using the features of <a class="reference external" href="http://docs.python.org/2.7/library/bisect.html#bisect" title="(in Python v2.7)"><tt class="docutils literal"><span class="pre">bisect</span></tt></a>.
Insertion, removal, and repositioning of elements in the priority
queue may be accomplished using <a class="reference internal" href="#coapy.util.TimeDueOrdinal.queue_insert" title="coapy.util.TimeDueOrdinal.queue_insert"><tt class="xref py py-meth docutils literal"><span class="pre">queue_insert()</span></tt></a>,
<a class="reference internal" href="#coapy.util.TimeDueOrdinal.queue_remove" title="coapy.util.TimeDueOrdinal.queue_remove"><tt class="xref py py-meth docutils literal"><span class="pre">queue_remove()</span></tt></a>, and <a class="reference internal" href="#coapy.util.TimeDueOrdinal.queue_reposition" title="coapy.util.TimeDueOrdinal.queue_reposition"><tt class="xref py py-meth docutils literal"><span class="pre">queue_reposition()</span></tt></a>.</p>
<p><em>time_due</em> as a keyword parameter initializes <a class="reference internal" href="#coapy.util.TimeDueOrdinal.time_due" title="coapy.util.TimeDueOrdinal.time_due"><tt class="xref py py-attr docutils literal"><span class="pre">time_due</span></tt></a> and
is removed from <em>kw</em>.  Any positional parameters and remaining
keyword parameters are passed to the next superclass.</p>
<dl class="method">
<dt id="coapy.util.TimeDueOrdinal.queue_insert">
<tt class="descname">queue_insert</tt><big>(</big><em>queue</em><big>)</big><a class="reference internal" href="_modules/coapy/util.html#TimeDueOrdinal.queue_insert"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#coapy.util.TimeDueOrdinal.queue_insert" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert this entry into <em>queue</em>.</p>
</dd></dl>

<dl class="staticmethod">
<dt id="coapy.util.TimeDueOrdinal.queue_ready_prefix">
<em class="property">static </em><tt class="descname">queue_ready_prefix</tt><big>(</big><em>queue</em>, <em>now=None</em><big>)</big><a class="reference internal" href="_modules/coapy/util.html#TimeDueOrdinal.queue_ready_prefix"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#coapy.util.TimeDueOrdinal.queue_ready_prefix" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the elements of <em>queue</em> that are due.</p>
<p><em>queue</em> is a sorted list of <a class="reference internal" href="#coapy.util.TimeDueOrdinal" title="coapy.util.TimeDueOrdinal"><tt class="xref py py-class docutils literal"><span class="pre">TimeDueOrdinal</span></tt></a> instances.
<em>now</em> is the timestamp, and defaults to <a class="reference internal" href="api.html#coapy.clock" title="coapy.clock"><tt class="xref py py-func docutils literal"><span class="pre">coapy.clock()</span></tt></a>.
Elements are due when <a class="reference internal" href="#coapy.util.TimeDueOrdinal.time_due" title="coapy.util.TimeDueOrdinal.time_due"><tt class="xref py py-attr docutils literal"><span class="pre">time_due</span></tt></a> &lt;= <em>now</em>.</p>
</dd></dl>

<dl class="method">
<dt id="coapy.util.TimeDueOrdinal.queue_remove">
<tt class="descname">queue_remove</tt><big>(</big><em>queue</em><big>)</big><a class="reference internal" href="_modules/coapy/util.html#TimeDueOrdinal.queue_remove"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#coapy.util.TimeDueOrdinal.queue_remove" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove this entry from <em>queue</em>.</p>
</dd></dl>

<dl class="method">
<dt id="coapy.util.TimeDueOrdinal.queue_reposition">
<tt class="descname">queue_reposition</tt><big>(</big><em>queue</em><big>)</big><a class="reference internal" href="_modules/coapy/util.html#TimeDueOrdinal.queue_reposition"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#coapy.util.TimeDueOrdinal.queue_reposition" title="Permalink to this definition">¶</a></dt>
<dd><p>Reposition this entry within <em>queue</em>.</p>
<p><em>self</em> must already be in the queue; only its position changes
(if necessary).</p>
</dd></dl>

<dl class="attribute">
<dt id="coapy.util.TimeDueOrdinal.time_due">
<tt class="descname">time_due</tt><em class="property"> = None</em><a class="headerlink" href="#coapy.util.TimeDueOrdinal.time_due" title="Permalink to this definition">¶</a></dt>
<dd><p>The time at which the subclass instance becomes relevant.</p>
<p>This is a value in the ordinal space defined by
<a class="reference internal" href="api.html#coapy.clock" title="coapy.clock"><tt class="xref py py-func docutils literal"><span class="pre">coapy.clock()</span></tt></a>.</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="coapy.util.to_display_text">
<tt class="descclassname">coapy.util.</tt><tt class="descname">to_display_text</tt><big>(</big><em>data</em><big>)</big><a class="reference internal" href="_modules/coapy/util.html#to_display_text"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#coapy.util.to_display_text" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <em>data</em> as human-readable text.</p>
<p>This is intended for diagnostic messages for values like tokens
and payloads that are sometimes text, and sometimes raw data.  If
<em>data</em> is <tt class="xref py py-class docutils literal"><span class="pre">bytes</span></tt> but all its characters are
<a class="reference external" href="http://docs.python.org/2.7/library/string.html#string.printable" title="(in Python v2.7)"><tt class="xref py py-data docutils literal"><span class="pre">printable</span></tt></a> return it as text,
otherwise return it as hex-encoded data (wrapped in square
brackets to distinguish the encoding, e.g.: <tt class="docutils literal"><span class="pre">[01020304]</span></tt> for
<tt class="docutils literal"><span class="pre">b'\x01\x02\x03\x04'</span></tt>).</p>
<p>Non-bytes data is simply converted to Unicode and returned in that
format.  (If <em>data</em> is already text, even if it&#8217;s Unicode, we
assume it&#8217;s displayable.  If it isn&#8217;t, select a better terminal
configuration.)</p>
</dd></dl>

<dl class="function">
<dt id="coapy.util.to_net_unicode">
<tt class="descclassname">coapy.util.</tt><tt class="descname">to_net_unicode</tt><big>(</big><em>text</em><big>)</big><a class="reference internal" href="_modules/coapy/util.html#to_net_unicode"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#coapy.util.to_net_unicode" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert text to Net-Unicode (<span class="target" id="index-0"></span><a class="rfc reference external" href="http://tools.ietf.org/html/rfc5198.html"><strong>RFC 5198</strong></a>) data.</p>
<p>This normalizes <em>text</em> to ensure all characters are their own
canonical equivalent in the NFC form (section 3 of <span class="target" id="index-1"></span><a class="rfc reference external" href="http://tools.ietf.org/html/rfc5198.html"><strong>RFC 5198</strong></a>).
The result is encoded in UTF-8 and returned as data.</p>
<p>The operation currently does not handle newline normalization
(section 2 item 2), since its use in CoAP is currently limited to
values of options with format <a class="reference internal" href="coapy_option.html#coapy.option.format_string" title="coapy.option.format_string"><tt class="xref py py-class docutils literal"><span class="pre">coapy.option.format_string</span></tt></a>
and diagnostic payloads.</p>
</dd></dl>

<dl class="function">
<dt id="coapy.util.url_quote">
<tt class="descclassname">coapy.util.</tt><tt class="descname">url_quote</tt><big>(</big><em>text</em>, <em>safe=u'/'</em><big>)</big><a class="reference internal" href="_modules/coapy/util.html#url_quote"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#coapy.util.url_quote" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform URL percent encoding on <em>text</em>.</p>
<p>If <em>text</em> is Unicode, it is first converted to
<a class="reference internal" href="#coapy.util.to_net_unicode" title="coapy.util.to_net_unicode"><tt class="xref py py-func docutils literal"><span class="pre">Net-Unicode</span></tt></a>.  <em>text</em> may also be data.</p>
<p>Unsafe characters are percent-escaped, and the result is returned
as text containing only ASCII characters.</p>
<p><em>safe</em> is as in <tt class="xref py py-func docutils literal"><span class="pre">urllib.parse</span></tt>.</p>
<p>Encapsulated because in Python 3 <tt class="xref py py-func docutils literal"><span class="pre">urllib.parse.quote</span></tt>
works directly on Unicode strings, while in Python 2 the
corresponding <a class="reference external" href="http://docs.python.org/2.7/library/urllib.html#urllib.quote" title="(in Python v2.7)"><tt class="docutils literal"><span class="pre">urllib.quote()</span></tt></a> does not tolerate
Unicode characters and does not like <em>safe</em> to be a Unicode
string as it is since we use unicode_literals).</p>
</dd></dl>

<dl class="function">
<dt id="coapy.util.url_unquote">
<tt class="descclassname">coapy.util.</tt><tt class="descname">url_unquote</tt><big>(</big><em>quoted</em><big>)</big><a class="reference internal" href="_modules/coapy/util.html#url_unquote"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#coapy.util.url_unquote" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform URL percent decoding on <em>quoted</em>.</p>
<p>Encapsulated because in Python 3
<tt class="xref py py-func docutils literal"><span class="pre">urllib.parse.unquote</span></tt> works directly on Unicode
strings, while in Python 2 the corresponding
<a class="reference external" href="http://docs.python.org/2.7/library/urllib.html#urllib.unquote" title="(in Python v2.7)"><tt class="docutils literal"><span class="pre">urllib.unquote()</span></tt></a> does not tolerate Unicode
characters.</p>
</dd></dl>

<dl class="function">
<dt id="coapy.util.format_time">
<tt class="descclassname">coapy.util.</tt><tt class="descname">format_time</tt><big>(</big><em>tval=None</em>, <em>format=u'iso'</em><big>)</big><a class="reference internal" href="_modules/coapy/util.html#format_time"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#coapy.util.format_time" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert a date/time value to a standard representation and
validity duration.</p>
<p>The return value <tt class="docutils literal"><span class="pre">(rep,</span> <span class="pre">vsec)</span></tt> provides the representation of
<em>tval</em> using style <em>format</em>.  Representation <em>rep</em> is expected to
be unchanged for <em>vsec</em> seconds after the represented time.</p>
<p><em>tval</em> is a <a class="reference external" href="http://docs.python.org/2.7/library/datetime.html#datetime.datetime" title="(in Python v2.7)"><tt class="docutils literal"><span class="pre">datetime.datetime</span></tt></a>,
<a class="reference external" href="http://docs.python.org/2.7/library/time.html#time.struct_time" title="(in Python v2.7)"><tt class="docutils literal"><span class="pre">time.struct_time</span></tt></a>, or POSIX ordinal as from
<a class="reference external" href="http://docs.python.org/2.7/library/time.html#time.time" title="(in Python v2.7)"><tt class="docutils literal"><span class="pre">time.time()</span></tt></a>.  It is interpreted as being a universal
time (i.e., conversions do not account for time zone).</p>
<p><em>format</em> is one of the following:</p>
<table border="1" class="docutils">
<colgroup>
<col width="8%" />
<col width="25%" />
<col width="7%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Format</th>
<th class="head">rep</th>
<th class="head">vsec</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>iso</td>
<td>2013-10-11T10:46:23</td>
<td>0</td>
<td>ISO 8601 combined date and time</td>
</tr>
<tr class="row-odd"><td>ord</td>
<td>2013-284</td>
<td>47617</td>
<td>ISO 8601 ordinal date</td>
</tr>
<tr class="row-even"><td>pgd</td>
<td>735152</td>
<td>47617</td>
<td>Proleptic Gregorian Ordinal Day</td>
</tr>
<tr class="row-odd"><td>jd</td>
<td>2456576.94888</td>
<td>0</td>
<td>Julian Date</td>
</tr>
<tr class="row-even"><td>mjd</td>
<td>56576.4488773</td>
<td>0</td>
<td>Modified Julian Date</td>
</tr>
<tr class="row-odd"><td>tjd</td>
<td>16576.4488773</td>
<td>0</td>
<td>Truncated Julian Date</td>
</tr>
<tr class="row-even"><td>jdn</td>
<td>2456576</td>
<td>4417</td>
<td>Julian Day Number</td>
</tr>
<tr class="row-odd"><td>doy</td>
<td>284</td>
<td>47617</td>
<td>Day-of-year</td>
</tr>
<tr class="row-even"><td>dow</td>
<td>5</td>
<td>47617</td>
<td>Day-of-week (ISO: Mon=1 Sun=7)</td>
</tr>
<tr class="row-odd"><td>mod</td>
<td>646</td>
<td>37</td>
<td>Minute-of-day</td>
</tr>
<tr class="row-even"><td>posix</td>
<td>1381488383</td>
<td>0</td>
<td>Seconds since POSIX epoch 1970-01-01T00:00:00</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="coapy_endpoint.html"
                        title="previous chapter">coapy.endpoint</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="coapy_httputil.html"
                        title="next chapter">coapy.httputil</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/coapy_util.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="coapy_httputil.html" title="coapy.httputil"
             >next</a> |</li>
        <li class="right" >
          <a href="coapy_endpoint.html" title="coapy.endpoint"
             >previous</a> |</li>
        <li><a href="index.html">CoAPy 0.0.0 documentation</a> &raquo;</li>
          <li><a href="api.html" >API</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Peter A. Bigot.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>